3D implementation using periodic boundary conditions
